<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Saga :: Red Hat build of Apache Camel</title>
    <meta name="description" content="Enables Sagas on the route">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">Red Hat build of Apache Camel</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="components" data-version="4.0.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Camel Components</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="aggregate-eip.html">Aggregate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="bean-eip.html">Bean</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="change-data-capture.html">Change Data Capture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="channel-adapter.html">Channel Adapter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="choice-eip.html">Content Based Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="circuitBreaker-eip.html">Circuit Breaker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="claimCheck-eip.html">Claim Check</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="competing-consumers.html">Competing Consumers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="composed-message-processor.html">Composed Message Processor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="content-enricher.html">Content Enricher</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="content-filter-eip.html">Content Filter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="convertBodyTo-eip.html">Convert Body To</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="correlation-identifier.html">Correlation Identifier</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="dead-letter-channel.html">Dead Letter Channel</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="delay-eip.html">Delay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="durable-subscriber.html">Durable Subscriber</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="dynamicRouter-eip.html">Dynamic Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="enrich-eip.html">Enrich</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="eventDrivenConsumer-eip.html">Event Driven Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="event-message.html">Event Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="filter-eip.html">Filter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="from-eip.html">From</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="guaranteed-delivery.html">Guaranteed Delivery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="idempotentConsumer-eip.html">Idempotent Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="intercept.html">Intercept</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kamelet-eip.html">Kamelet</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="loadBalance-eip.html">Load Balance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="log-eip.html">Log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="loop-eip.html">Loop</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="marshal-eip.html">Marshal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message.html">Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-broker.html">Message Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-bus.html">Message Bus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-channel.html">Message Channel</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-dispatcher.html">Message Dispatcher</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-endpoint.html">Message Endpoint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-expiration.html">Message Expiration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-history.html">Message History</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-router.html">Message Router</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-translator.html">Message Translator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="messaging-bridge.html">Messaging Bridge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="messaging-gateway.html">Messaging Gateway</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="messaging-mapper.html">Messaging Mapper</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="multicast-eip.html">Multicast</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="normalizer.html">Normalizer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pipeline-eip.html">Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="point-to-point-channel.html">Point to Point Channel</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pollEnrich-eip.html">Poll Enrich</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="polling-consumer.html">Polling Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="process-eip.html">Process</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="process-manager.html">Process Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="publish-subscribe-channel.html">Publish Subscribe Channel</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="recipientList-eip.html">Recipient List</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="removeHeader-eip.html">Remove Header</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="removeHeaders-eip.html">Remove Headers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="removeProperties-eip.html">Remove Properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="removeProperty-eip.html">Remove Property</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="requestReply-eip.html">Request Reply</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="resequence-eip.html">Resequence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="resilience4j-eip.html">Resilience4j Circuit Breaker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="return-address.html">Return Address</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rollback-eip.html">Rollback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="routingSlip-eip.html">Routing Slip</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="saga-eip.html">Saga</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sample-eip.html">Sample</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="scatter-gather.html">Scatter Gather</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="script-eip.html">Script</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="selective-consumer.html">Selective Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="service-activator.html">Service Activator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serviceCall-eip.html">Service Call</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setBody-eip.html">Set Body</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setHeader-eip.html">Set Header</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setProperty-eip.html">Set Property</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sort-eip.html">Sort</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="split-eip.html">Split</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="step-eip.html">Step</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="stop-eip.html">Stop</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="threads-eip.html">Threads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="throttle-eip.html">Throttle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="to-eip.html">To</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="toD-eip.html">To Dynamic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transactional-client.html">Transactional Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transform-eip.html">Transform</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="unmarshal-eip.html">Unmarshal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="validate-eip.html">Validate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="wireTap-eip.html">Wire Tap</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Camel Components</span>
    <span class="version">4.0.x</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../../4.10.x/index.html">Camel Components</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../4.10.x/index.html">4.10.x (LTS)</a>
        </li>
        <li class="version">
          <a href="../../4.8.x/index.html">4.8.x</a>
        </li>
        <li class="version">
          <a href="../../4.4.x/index.html">4.4.x</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">4.0.x</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../manual/4.10.x/index.html">User manual</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../manual/4.10.x/index.html">4.10.x</a>
        </li>
        <li class="version">
          <a href="../../../manual/4.8.x/index.html">4.8.x</a>
        </li>
        <li class="version">
          <a href="../../../manual/4.4.x/index.html">4.4.x</a>
        </li>
        <li class="version">
          <a href="../../../manual/4.0.x/index.html">4.0.x</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../manual/4.10.x/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Camel Components</a></li>
    <li><a href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a></li>
    <li><a href="saga-eip.html">Saga</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">4.0.x</button>
  <div class="version-menu">
    <a class="version" href="../../4.10.x/eips/saga-eip.html">4.10.x (LTS)</a>
    <a class="version" href="../../4.8.x/eips/saga-eip.html">4.8.x</a>
    <a class="version" href="../../4.4.x/eips/saga-eip.html">4.4.x</a>
    <a class="version is-current" href="saga-eip.html">4.0.x</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/rhaetor/rh-camel-jboss/edit/camel-4.0.0-branch/core/camel-core-engine/src/main/docs/modules/eips/pages/saga-eip.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Saga</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Saga EIP provides a way to define a series of related actions in a Camel route that should be either completed successfully (<strong>all of them</strong>) or not-executed/compensated.
Sagas implementations are able to coordinate <strong>distributed services communicating using any transport</strong> towards a globally <strong>consistent outcome</strong>.</p>
</div>
<div class="paragraph">
<p>Although their main purpose is similar, Sagas are different from classical ACID distributed (XA) transactions because the status of the different participating services is guaranteed to be consistent
only at the end of the Saga and not in any intermediate step (lack of isolation).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/eip/SagaPattern.png" alt="image">
</div>
</div>
<div class="paragraph">
<p>Conversely, Sagas are suitable for many use cases where usage of distributed transactions is discouraged.
For example, services participating in a Saga are allowed to use any kind of datastore: classical databases or even NoSQL non-transactional databases.
Sagas are also suitable for being used in stateless cloud services as they do not require a transaction log
to be stored alongside the service.</p>
</div>
<div class="paragraph">
<p>Differently from transactions, Sagas are also not required to be completed in a small amount of time, because they don&#8217;t use database-level locks. They can live for a longer timespan: from few seconds to several days.
The Saga EIP implementation based on the MicroProfile sandbox spec (see camel-lra) is indeed called LRA that stands for "Long Running Action".
It also supports coordination of external <strong>heterogeneous services</strong>, written with any language/technology and also running outside a JVM.</p>
</div>
<div class="paragraph">
<p>Sagas don&#8217;t use locks on data, instead they define the concept of "Compensating Action" that is an action that should be executed when the standard flow encounters an error,
with the purpose of restoring the status that was present before the flow execution.
Compensating actions can be declared in Camel routes using the Java or XML DSL and will be invoked by Camel only when needed (if the saga is cancelled due to an error).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_options"><a class="anchor" href="#_options"></a>Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Saga eip supports 8 options, which are listed below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 50%;">
<col style="width: 10%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_sagaService">sagaService</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Refers to the id to lookup in the registry for the specific CamelSagaService to use.</p>
</div></div></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelSagaService</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_propagation">propagation</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set the Saga propagation mode (REQUIRED, REQUIRES_NEW, MANDATORY, SUPPORTS, NOT_SUPPORTED, NEVER).</p>
</div>
<div class="paragraph">
<p>Enum values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>REQUIRED</p>
</li>
<li>
<p>REQUIRES_NEW</p>
</li>
<li>
<p>MANDATORY</p>
</li>
<li>
<p>SUPPORTS</p>
</li>
<li>
<p>NOT_SUPPORTED</p>
</li>
<li>
<p>NEVER</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">REQUIRED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SagaPropagation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_completionMode">completionMode</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determine how the saga should be considered complete. When set to AUTO, the saga is completed when the exchange that initiates the saga is processed successfully, or compensated when it completes exceptionally. When set to MANUAL, the user must complete or compensate the saga using the saga:complete or saga:compensate endpoints.</p>
</div>
<div class="paragraph">
<p>Enum values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AUTO</p>
</li>
<li>
<p>MANUAL</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">AUTO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SagaCompletionMode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_timeout">timeout</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set the maximum amount of time for the Saga. After the timeout is expired, the saga will be compensated automatically (unless a different decision has been taken in the meantime).</p>
</div></div></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_compensation">compensation</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The compensation endpoint URI that must be called to compensate all changes done in the route. The route corresponding to the compensation URI must perform compensation and complete without error. If errors occur during compensation, the saga service may call again the compensation URI to retry.</p>
</div></div></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SagaActionUriDefinition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_completion">completion</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The completion endpoint URI that will be called when the Saga is completed successfully. The route corresponding to the completion URI must perform completion tasks and terminate without error. If errors occur during completion, the saga service may call again the completion URI to retry.</p>
</div></div></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SagaActionUriDefinition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_option">option</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to save properties of the current exchange in order to re-use them in a compensation/completion callback route. Options are usually helpful e.g. to store and retrieve identifiers of objects that should be deleted in compensating actions. Option values will be transformed into input headers of the compensation/completion exchange.</p>
</div></div></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_outputs">outputs</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Required</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_disabled">disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether to disable this EIP from the route during build time. Once an EIP has been disabled then it cannot be enabled later at runtime.</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong id="_option_description">description</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sets the description of this node.</p>
</div></div></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DescriptionDefinition</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_exchange_properties"><a class="anchor" href="#_exchange_properties"></a>Exchange properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following exchange properties are set on each <code>Exchange</code> participating in a Saga (normal actions, compensating actions and completions):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 36.3636%;">
<col style="width: 18.1818%;">
<col style="width: 45.4546%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>Long-Running-Action</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>String</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A globally unique identifier for the Saga that can be propagated to remote systems using transport-level headers (e.g. HTTP).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_saga_service_configuration"><a class="anchor" href="#_saga_service_configuration"></a>Saga Service Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Saga EIP requires that a service implementing the interface <code>org.apache.camel.saga.CamelSagaService</code> is added to the `CamelContext.</p>
</div>
<div class="paragraph">
<p>Camel currently supports the following Saga Services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>InMemorySagaService</code>: Is a <strong>basic</strong> implementation of the Saga EIP that does not support advanced features (no remote context propagation, no consistency guarantee in case of application failure).</p>
</li>
<li>
<p><code>LRASagaService</code>: Is a <strong>fully-fledged</strong> implementation of the Saga EIP based on MicroProfile sandbox LRA specification that supports remote context propagation and provides consistency guarantees in case of application failure.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_using_the_in_memory_saga_service"><a class="anchor" href="#_using_the_in_memory_saga_service"></a>Using the In-Memory Saga Service</h3>
<div class="paragraph">
<p>The in-memory Saga service is not recommended for production environments as it does not support persistence of the Saga status (it is kept only in-memory),
so it cannot guarantee consistency of Sagas in case of application failure (e.g. JVM crash).</p>
</div>
<div class="paragraph">
<p>Also, when using an in-memory Saga service, Saga contexts cannot be propagated to remote services using transport-level headers (it can be done with other implementations).</p>
</div>
<div class="paragraph">
<p>Users that want to use the in-memory saga service should add the following code to customize the Camel context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.addService(new org.apache.camel.saga.InMemorySagaService());</code></pre>
</div>
</div>
<div class="paragraph">
<p>This service belongs in the <code>camel-support</code> module.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_lra_saga_service"><a class="anchor" href="#_using_the_lra_saga_service"></a>Using the LRA Saga Service</h3>
<div class="paragraph">
<p>The LRA Saga Service is an implementation based on the MicroProfile sandbox LRA specification.
It leverages an <strong>external Saga coordinator</strong> to control the execution of the various steps of the Saga.
The proposed reference implementation for the LRA specification is the <a href="http://jbossts.blogspot.it/2017/12/narayana-lra-implementation-of-saga.html">Narayana LRA Coordinator</a>.
Users can follow instructions present on the Narayana website to <strong>startup a remote instance of the coordinator</strong>.</p>
</div>
<div class="paragraph">
<p>The URL of the LRA coordinator is a required parameter of the Camel LRA service. The Camel application and the LRA service communicate using the HTTP protocol.</p>
</div>
<div class="paragraph">
<p>In order to use the LRA Saga service, maven users will need to add the following dependency to their pom.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
 &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
 &lt;artifactId&gt;camel-lra&lt;/artifactId&gt;
 &lt;!-- use the same version as your Camel core version --&gt;
 &lt;version&gt;x.y.z&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Camel REST context is also required to be present for the LRA implementation to work. You may add <code>camel-undertow</code> for example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
 &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
 &lt;artifactId&gt;camel-undertow&lt;/artifactId&gt;
 &lt;!-- use the same version as your Camel core version --&gt;
 &lt;version&gt;x.y.z&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The LRA implementation of the Saga EIP will add some web endpoints under the "/lra-participant" path.
Those endpoints will be used by the LRA coordinator for calling back the application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Configure the LRA saga service
org.apache.camel.service.lra.LRASagaService sagaService = new org.apache.camel.service.lra.LRASagaService();
sagaService.setCoordinatorUrl("http://lra-service-host");
sagaService.setLocalParticipantUrl("http://my-host-as-seen-by-lra-service:8080/context-path");

// Add it to the Camel context
context.addService(sagaService);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_lra_saga_service_in_spring_boot"><a class="anchor" href="#_using_the_lra_saga_service_in_spring_boot"></a>Using the LRA Saga Service in Spring Boot</h4>
<div class="paragraph">
<p>Spring Boot users can use a simplified configuration model for the LRA Saga Service. Maven users can
include the <strong>camel-lra-starter</strong> module in their project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
 &lt;groupId&gt;org.apache.camel.springboot&lt;/groupId&gt;
 &lt;artifactId&gt;camel-lra-starter&lt;/artifactId&gt;
 &lt;!-- use the same version as your Camel core version --&gt;
 &lt;version&gt;x.y.z&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
 &lt;groupId&gt;org.apache.camel.springboot&lt;/groupId&gt;
 &lt;artifactId&gt;camel-undertow-starter&lt;/artifactId&gt;
 &lt;!-- use the same version as your Camel core version --&gt;
 &lt;version&gt;x.y.z&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration can be done in the Spring Boot <code>application.yaml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">application.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">camel:
  lra:
    enabled: true
    coordinator-url: http://lra-service-host
    local-participant-url: http://my-host-as-seen-by-lra-service:8080/context-path</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once done, the Saga EIP can be directly used inside Camel routes, and it will use the LRA Saga Service under the hood.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose you want to place a new order, and you have two distinct services in your system: one managing the orders and one managing the credit.
Logically you can place an order if you have enough credit for it.</p>
</div>
<div class="paragraph">
<p>With the Saga EIP you can model the <em>direct:buy</em> route as a Saga composed of two distinct actions, one to create the order and one to take the credit.
<strong>Both actions must be executed, or none of them</strong>: an order placed without credit can be considered an inconsistent outcome (and a payment without an order).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:buy")
  .saga()
    .to("direct:newOrder")
    .to("direct:reserveCredit");</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>That&#8217;s it</strong>. The buy action will not change for the rest of the examples. We&#8217;ll just see different options that can be used to model the "New Order" and "Reserve Credit" actions in the following.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We have used a <em>direct</em> endpoint to model the two actions since this example can be used with both implementations of the Saga service,
but we could have used <strong>http</strong> or other kinds of endpoint with the LRA Saga service.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both services called by the <em>direct:buy</em> route can <strong>participate in the Saga</strong> and declare their compensating actions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:newOrder")
  .saga()
  .propagation(SagaPropagation.MANDATORY)
  .compensation("direct:cancelOrder")
    .transform().header(Exchange.SAGA_LONG_RUNNING_ACTION)
    .bean(orderManagerService, "newOrder")
    .log("Order ${body} created");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the propagation mode is set to <em>MANDATORY</em> meaning that any exchange flowing in this route must be already part of a saga
(and it is the case in this example, since the saga is created in the <em>direct:buy</em> route).</p>
</div>
<div class="paragraph">
<p>The <em>direct:newOrder</em> route declares a compensating action that is called <em>direct:cancelOrder</em>, responsible for undoing the order in case the saga is cancelled.</p>
</div>
<div class="paragraph">
<p>Each exchange always contains a <code>Exchange.SAGA_LONG_RUNNING_ACTION</code> header that here is used as id of the order.
This is done in order to identify the order to delete in the corresponding compensating action, but it is not a requirement (options can be used as alternative solution).</p>
</div>
<div class="paragraph">
<p>The compensating action of <em>direct:newOrder</em> is <em>direct:cancelOrder,</em> and it&#8217;s shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:cancelOrder")
  .transform().header(Exchange.SAGA_LONG_RUNNING_ACTION)
  .bean(orderManagerService, "cancelOrder")
  .log("Order ${body} cancelled");</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is called automatically by the Saga EIP implementation when the order should be cancelled.</p>
</div>
<div class="paragraph">
<p>It should not terminate with error. In case an error is thrown in the <em>direct:cancelOrder</em> route, the EIP implementation should
periodically retry to execute the compensating action up to a certain limit.
This means that <strong>any compensating action must be idempotent</strong>, so it should take into account that it may be triggered multiple times and should not fail in any case.</p>
</div>
<div class="paragraph">
<p>If compensation cannot be done after all retries, a manual intervention process should be triggered by the Saga implementation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It may happen that due to a delay in the execution of the <em>direct:newOrder</em> route the Saga is cancelled by another party in the meantime (due to an error in a parallel route or a timeout at Saga level).</p>
</div>
<div class="paragraph">
<p>So, when the compensating action <em>direct:cancelOrder</em> is called, it may not find the Order record that should be cancelled.
It is important, in order to guarantee full global consistency, that <strong>any main action and its corresponding compensating action are commutative</strong>,
i.e. if compensation occurs before the main action it should have the same effect.</p>
</div>
<div class="paragraph">
<p>Another possible approach, when using a commutative behavior is not possible,
is to consistently fail in the compensating action until data produced by the main action is found (or the maximum number of retries is exhausted):
this approach may work in many contexts, but it&#8217;s <strong>heuristic</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The credit service may be implemented almost in the same way as the order service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// action
from("direct:reserveCredit")
  .saga()
  .propagation(SagaPropagation.MANDATORY)
  .compensation("direct:refundCredit")
    .transform().header(Exchange.SAGA_LONG_RUNNING_ACTION)
    .bean(creditService, "reserveCredit")
    .log("Credit ${header.amount} reserved in action ${body}");

// compensation
from("direct:refundCredit")
  .transform().header(Exchange.SAGA_LONG_RUNNING_ACTION)
  .bean(creditService, "refundCredit")
  .log("Credit for action ${body} refunded");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the compensating action for a credit reservation is a refund.</p>
</div>
<div class="paragraph">
<p>This completes the example. It can be run with both implementations of the Saga EIP, as it does not involve remote endpoints.</p>
</div>
<div class="paragraph">
<p>Further, options will be shown next.</p>
</div>
<div class="sect2">
<h3 id="_handling_completion_events"><a class="anchor" href="#_handling_completion_events"></a>Handling Completion Events</h3>
<div class="paragraph">
<p>It is often required to do some processing when the Saga is completed. Compensation endpoints are invoked when something wrong happens and the Saga is cancelled.
Equivalently, <strong>completion endpoints</strong> can be invoked to do further processing when the Saga is completed successfully.</p>
</div>
<div class="paragraph">
<p>For example, in the order service above, we may need to know when the order is completed (and the credit reserved) to actually start preparing the order.
We will not want to start to prepare the order if the payment is not done (unlike most modern CPUs that give you access to reserved memory before ensuring that you have rights to read it).</p>
</div>
<div class="paragraph">
<p>This can be done easily with a modified version of the <em>direct:newOrder</em> endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:newOrder")
  .saga()
  .propagation(SagaPropagation.MANDATORY)
  .compensation("direct:cancelOrder")
  .completion("direct:completeOrder") // completion endpoint
    .transform().header(Exchange.SAGA_LONG_RUNNING_ACTION)
    .bean(orderManagerService, "newOrder")
    .log("Order ${body} created");

// direct:cancelOrder is the same as in the previous example

// called on successful completion
from("direct:completeOrder")
  .transform().header(Exchange.SAGA_LONG_RUNNING_ACTION)
  .bean(orderManagerService, "findExternalId")
  .to("jms:prepareOrder")
  .log("Order ${body} sent for preparation");</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the Saga is completed, the order is sent to a JMS queue for preparation.</p>
</div>
<div class="paragraph">
<p>Like compensating actions, also completion actions may be called multiple times by the Saga coordinator (especially in case of errors, like network errors).
In this example, the service listening to the <em>prepareOrder</em> JMS queue should be prepared to hold possible duplicates (see the Idempotent Consumer EIP for examples on how to handle duplicates).</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_custom_identifiers_and_options"><a class="anchor" href="#_using_custom_identifiers_and_options"></a>Using Custom Identifiers and Options</h3>
<div class="paragraph">
<p>The example shown so far use the <code>Exchange.SAGA_LONG_RUNNING_ACTION</code> as identifier for the resources (order and credit).
This is not always a desired approach, as it may pollute the business logic and the data model.</p>
</div>
<div class="paragraph">
<p>An alternative approach is to use Saga options to "register" custom identifiers.
For example, the credit service may be refactored as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// action
from("direct:reserveCredit")
  .bean(idService, "generateCustomId") // generate a custom Id and set it in the body
  .to("direct:creditReservation")

// delegate action
from("direct:creditReservation")
  .saga()
  .propagation(SagaPropagation.SUPPORTS)
  .option("CreditId", body()) // mark the current body as needed in the compensating action
  .compensation("direct:creditRefund")
    .bean(creditService, "reserveCredit")
    .log("Credit ${header.amount} reserved. Custom Id used is ${body}");

// called only if the saga is cancelled
from("direct:creditRefund")
  .transform(header("CreditId")) // retrieve the CreditId option from headers
  .bean(creditService, "refundCredit")
  .log("Credit for Custom Id ${body} refunded");</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note how the previous listing is not using the <code>Exchange.SAGA_LONG_RUNNING_ACTION</code> header at all.</strong></p>
</div>
<div class="paragraph">
<p>Since the <em>direct:creditReservation</em> endpoint can be now called also from outside a Saga, the propagation mode can be set to <strong>SUPPORTS</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Multiple options</strong> can be declared in a Saga route.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_timeouts"><a class="anchor" href="#_setting_timeouts"></a>Setting Timeouts</h3>
<div class="paragraph">
<p>Sagas are long-running actions, but this does not mean that they should not have a bounded timeframe to execute.
<strong>Setting timeouts on Sagas is always a good practice</strong> as it guarantees that a Saga does not remain stuck forever in the case of machine failure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Saga EIP implementation may have a default timeout set on all Sagas that don&#8217;t specify it explicitly</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the timeout expires, the Saga EIP will decide to <strong>cancel the Saga</strong> (and compensate all participants), unless a different decision has been taken before.</p>
</div>
<div class="paragraph">
<p>Timeouts can be set on Saga participants as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:newOrder")
  .saga()
  .timeout(1, TimeUnit.MINUTES) // newOrder requires that the saga is completed within 1 minute
  .propagation(SagaPropagation.MANDATORY)
  .compensation("direct:cancelOrder")
  .completion("direct:completeOrder")
    // ...
    .log("Order ${body} created");</code></pre>
</div>
</div>
<div class="paragraph">
<p>All participants (e.g. credit service, order service) can set their own timeout. When a participant joins an existing transaction, the timeout of the already active saga can be influenced. It should calculate the moment in time the saga would become eligible for cancellation based on the time which the request enters the method and the timeout. When this moment is earlier than the moment calculated for the saga at that time, this new moment becomes the timeout moment for the saga. So when multiple participants define a timeout period, the earliest one will trigger the cancellation of the saga.</p>
</div>
<div class="paragraph">
<p>A timeout can also be specified at saga level as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:buy")
  .saga()
  .timeout(5, TimeUnit.MINUTES) // timeout at saga level
    .to("direct:newOrder")
    .to("direct:reserveCredit");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_choosing_propagation"><a class="anchor" href="#_choosing_propagation"></a>Choosing Propagation</h3>
<div class="paragraph">
<p>In the examples above, we have used the <em>MANDATORY</em> and <em>SUPPORTS</em> propagation modes, but also the <em>REQUIRED</em> propagation mode,
that is the default propagation used when nothing else is specified.</p>
</div>
<div class="paragraph">
<p>These propagation modes map 1:1 the equivalent modes used in transactional contexts. Here&#8217;s a summary of their meaning:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Propagation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>REQUIRED</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Join the existing saga or create a new one if it does not exist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>REQUIRES_NEW</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always create a new saga. Suspend the old saga and resume it when the new one terminates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>MANDATORY</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A saga must be already present. The existing saga is joined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>SUPPORTS</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a saga already exists, then join it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>NOT_SUPPORTED</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a saga already exists, it is suspended and resumed when the current block completes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>NEVER</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current block must never be invoked within a saga.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_using_manual_completion_advanced"><a class="anchor" href="#_using_manual_completion_advanced"></a>Using Manual Completion (Advanced)</h3>
<div class="paragraph">
<p>When a Saga cannot be all executed in a synchronous way, but it requires e.g. communication with external services using asynchronous communication channels,
the completion mode cannot be set to <em>AUTO</em> (default), because the saga is not completed when the exchange that creates it is done.</p>
</div>
<div class="paragraph">
<p>This is often the case for Sagas that have long execution times (hours, days). In these cases, the <em>MANUAL</em> completion mode should be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:mysaga")
  .saga()
  .completionMode(SagaCompletionMode.MANUAL)
  .completion("direct:finalize")
  .timeout(2, TimeUnit.HOURS)
    .to("seda:newOrder")
    .to("seda:reserveCredit");

// Put here asynchronous processing for seda:newOrder and seda:reserveCredit
// They will send asynchronous callbacks to seda:operationCompleted

from("seda:operationCompleted") // an asynchronous callback
  .saga()
  .propagation(SagaPropagation.MANDATORY)
    .bean(controlService, "actionExecuted")
    .choice()
      .when(body().isEqualTo("ok"))
        .to("saga:complete") // complete the current saga manually (saga component)
    .end()

// You can put here the direct:finalize endpoint to execute final actions</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting the completion mode to <em>MANUAL</em> means that the saga is not completed when the exchange is processed in the route <em>direct:mysaga</em> but
it will last longer (max duration is set to 2 hours).</p>
</div>
<div class="paragraph">
<p>When both asynchronous actions are completed the saga is completed. The call to complete is done using the Camel Saga Component&#8217;s <em>saga:complete</em> endpoint.
There is a similar endpoint for manually compensating the Saga (<em>saga:compensate</em>).</p>
</div>
<div class="paragraph">
<p>Apparently the addition of the saga markers do not add much value to the flow: it works also if you remove all Saga EIP configuration.
But Sagas add a lot of value, since they guarantee that even in the presence of unexpected issues (servers crashing, messages are lost)
there will always be a consistent outcome: order placed and credit reserved, or none of them changed.
In particular, if the Saga is not completed within 2 hours, the compensation mechanism will take care of fixing the status.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_saga_with_xml_dsl"><a class="anchor" href="#_using_saga_with_xml_dsl"></a>Using Saga with XML DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Saga features are also available for users that want to use the XML DSL.</p>
</div>
<div class="paragraph">
<p>The following snipped shows an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;route&gt;
  &lt;from uri="direct:start"/&gt;
  &lt;saga&gt;
    &lt;compensation uri="direct:compensation" /&gt;
    &lt;completion uri="direct:completion" /&gt;
    &lt;option optionName="myOptionKey"&gt;
      &lt;constant&gt;myOptionValue&lt;/constant&gt;
    &lt;/option&gt;
    &lt;option optionName="myOptionKey2"&gt;
      &lt;constant&gt;myOptionValue2&lt;/constant&gt;
    &lt;/option&gt;
  &lt;/saga&gt;
  &lt;to uri="direct:action1" /&gt;
  &lt;to uri="direct:action2" /&gt;
&lt;/route&gt;</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
